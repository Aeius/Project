<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itwillbs.mapper.OrderListMapper">

<!-- 	<select id="getOrderList" resultType="com.itwillbs.domain.OrderListBean" > -->
<!-- 		SELECT  -->
<!-- 			product_name, -->
<!-- 		    product_idx, -->
<!-- 		    order_detail_order_idx, -->
<!-- 		    order_status -->
			
<!-- 			FROM order_detail, product, orderlist -->
<!-- 			WHERE  -->
<!-- 			product_idx = order_detail_product_idx  -->
<!--             and order_detail_order_idx = order_idx  -->
<!--             and order_member_email = #{order_member_email} -->
<!-- 	</select> -->

	<select id="getOrderList" resultType="com.itwillbs.domain.OrderListBean" >
		SELECT 
			product_name,
		    product_idx,
		    order_detail_order_idx,
		    order_status,
		    review_product_idx
			
			FROM order_detail, product, orderlist, review
			WHERE 
			product_idx = order_detail_product_idx 
			and review_product_idx = product_idx
            and order_detail_order_idx = order_idx 
            and order_member_email = #{order_member_email}
	</select>
	
		<select id="getOrderListPage" resultType="com.itwillbs.domain.OrderListBean" >
		SELECT 
			product_name,
		    product_idx,
		    order_detail_order_idx,
		    order_status,
		    review_product_idx
			
			FROM order_detail, product, orderlist, review
			WHERE 
			product_idx = order_detail_product_idx 
			and review_product_idx = product_idx
            and order_detail_order_idx = order_idx 
            and order_member_email = #{order_member_email}
		    
		    order by order_idx desc limit #{startRow},#{pageSize}
	</select>
	
<!-- 	<select id="getOrderListPage" resultType="com.itwillbs.domain.OrderListBean" > -->
<!-- 		SELECT  -->
<!-- 			product_name, -->
<!-- 		    product_idx, -->
<!-- 		    order_detail_order_idx, -->
<!-- 		    order_status -->
			
<!-- 			FROM order_detail, product, orderlist -->
<!-- 			WHERE  -->
<!-- 			product_idx = order_detail_product_idx  -->
<!--             and order_detail_order_idx = order_idx  -->
<!--             and order_member_email = #{order_member_email} -->
		    
<!-- 		    order by order_idx desc limit #{startRow},#{pageSize} -->
<!-- 	</select> -->
	
	<select id="getOrderListCount" resultType="java.lang.Integer">
  		select count(*) FROM orderlist, order_detail, product
			WHERE 
			order_idx = order_detail_order_idx
		    AND
		    order_member_email = #{order_member_email};
  	</select>

	<select id="getOrderMember" resultType="com.itwillbs.domain.OrderListBean" >
		SELECT * FROM orderlist WHERE order_idx = #{order_idx}
	</select>
	
<!-- 	<select id="getReviewCheck" resultType="com.itwillbs.domain.OrderListBean" > -->
<!-- 	select review_idx, review_product_idx, product_idx  -->
<!-- 	from review, product  -->
<!-- 	where review_email = #{review_email} -->
<!-- 	and product_idx = review_product_idx	 -->
<!-- 	</select> -->

	<select id="getReviewCheck" resultType="com.itwillbs.domain.OrderListBean" >
		select review_idx, review_product_idx, product_idx 
		from review, product 
		where review_email = #{review_email}
		and product_idx = review_product_idx 
		and review_idx = #{review_idx}
	</select>
	
<!-- 	<select id="getReviewCheck1" resultType="com.itwillbs.domain.OrderListBean" > -->
<!-- 		select review_idx, review_product_idx, product_idx  -->
<!-- 		from review, product  -->
<!-- 		where review_email = #{review_email} -->
<!-- 		and product_idx = review_product_idx  -->
<!-- 		and review_idx = #{review_idx} -->
<!-- 	</select> -->
	
	<select id="getReviewFind" resultType="com.itwillbs.domain.OrderListBean" >
		select review_idx
		from review
		where review_email = #{review_email}
	</select>
	
	
	<update id="updateOrder">
		UPDATE orderlist SET
			order_status = #{order_status}
		WHERE order_idx = #{order_idx}
	</update>
	
</mapper>